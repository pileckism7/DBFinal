/*
 * TODO
 * 		Color themes
 * 		Add in a rating
 * 		Adventureworks string parsing (FIX error)
 * 		Above ADmin, welcome back greeting
 */

/**
 * Graduate DataBases Final Project GUI
 * Professor Myers
 * 
 * @author martinprice
 * @author Mantas P
 * @author Chris Malitsky
 * @version November 18, 2018
 */
import java.sql.*;
import java.awt.*;
import java.awt.event.KeyEvent;
import javax.swing.*;
public class GUI extends JFrame
{
	/** Instance Fields for SQL connection */
	private String username;
	private String password;
	private Connection conn;
	private Statement query;
	private ResultSet result;
	
	/** Instance Fields for GUI*/
	private JButton addToCart;
	private JButton addToWishList;
	private JButton saveCart;
	private JButton placeOrder;
	private JButton adminTools;
	private JButton search;
	private JButton wishListOrder;
	private JButton wishListRemove;
	private JButton previousPage;
	private JButton nextPage;
	private JLabel currentPage;
	
	private JPanel inventory;
	private JPanel inventoryButtons;
	private JPanel admin;
	private JPanel cart;
	private JPanel cartButtons;
	private JPanel wishList;
	private JPanel options;
	private JPanel userSelect;
	
	private JList products;
	private JLabel productName;
	private JLabel productDescription;
	private JLabel productCost;
	
	private JList shoppingCart;
	private JLabel totalCost;
	
	private JList userWishList;
	private JLabel userAdvertisement;
	
	private JComboBox users;
	private JComboBox filterSearch;
	private JComboBox filterSubSearch;
	private JLabel subSearchLabel;
	
	private JSlider priceRange;
	private JLabel maxPrice;
 
	private JMenuBar menu;
	
	private final int SHORTCUT_MASK = Toolkit.getDefaultToolkit().getMenuShortcutKeyMask();
	
	/** Instance fields for Variables */
	private int currentPageNumber;
	private int MAX_PAGES;
	private int size;
	private final int MAX_RESULTS_PER_PAGE = 23;
	
	private String queryString;
	private String queryDetailsString;
	private String dbPriceFilter;
	private String currentDB;
	
	/** Constructor 
	 * @throws SQLException */
	public GUI(String un, String pw)
	{
		super("Daymnzon.com");
		username = un;
		password = pw;
		if(setUpConnection(un, pw))
		{
			System.out.println("CONNECTION ESTABLSIHED");
			createGUI();
		}	
		else
			System.err.println("COULD NOT CONNECT TO THE DATABASE");
	}
	
	/**
	 * Initializes SQL variables and connects to the data base
	 *
	 * @param un : user name
	 * @param pw : password
	 * @return true, no issues
	 * @throws SQLException 
	 */
	private boolean setUpConnection(String un, String pw)
	{
		try 
		{
			conn = DriverManager.getConnection(String.format("jdbc:mysql://elvis.rowan.edu:3306/%s?&useSSL=false&useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC", un), un, pw);
			query = conn.createStatement();
			return true;
		}
		catch(SQLException e) {e.printStackTrace(); return false;}
	}
	
	/** Calls all the methods which create the individual components */
	private void createGUI()
	{
		setSize(1000, 850);
		setLayout(null);
		
		buildMenuBar();
		buildUsers();
		buildInventory();
		buildCart();
		buildWishList();
		buildAdmin();
		buildOptions();
		
		setVisible(true);
	}
	
	/** 
	 * Builds the menu bar
	 * Menu Bar contains:
	 * 	file > quit
	 */
	private void buildMenuBar()
	{
		menu = new JMenuBar();
		setJMenuBar(menu);
		
		//file
		JMenu file = new JMenu("File");
		menu.add(file);
		JMenuItem quit = new JMenuItem("Quit");
		quit.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_0, SHORTCUT_MASK));
		quit.addActionListener(e -> System.exit(0));
		file.add(quit);
	}
	
	/**
	 * Builds the users panel
	 */
	private void buildUsers()
	{
		userSelect = new JPanel();
		userSelect.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		userSelect.setLayout(new BorderLayout());
		userSelect.setBounds(750, 0, 250, 50);
		
		try {users = new JComboBox(populateUsers(new DefaultComboBoxModel())); }
		catch(SQLException e) {}
		
		users.addActionListener(a -> {
			try { changeCurrentUser((String)users.getSelectedItem()); }
			catch(SQLException e) {}
		});
		userSelect.add(users, BorderLayout.CENTER);
		
		add(userSelect);
	}
	
	/**
	 * Changes the current user
	 *  > calculates the current customer_id
	 * 	> updates wish List
	 * 	> updates cart
	 * 	> changes Rate This Product
	 */
	private void changeCurrentUser(String currentUser) throws SQLException
	{
		String[] curr = currentUser.split(":");
		int c_id = Integer.parseInt(curr[0]);
		
		try {populateUserWishList(c_id, (DefaultListModel)userWishList.getModel()); }
		catch(SQLException e) {}
		
		shoppingCart.setModel(new DefaultListModel());
	}
	
	/**
	 * Updates the wishList for the current users
	 * > Removes all current values in the list,
	 * > runs query to get the wish list of the currentUser
	 */
	private void populateUserWishList(int customer_id, DefaultListModel wishList) throws SQLException
	{
		wishList.removeAllElements();
		result = query.executeQuery(String.format("CALL %s.wished_products_not_purchased(%d)", username, customer_id));
		while(result.next())
			wishList.addElement(String.format("%s:", result.getString("name")));
	}
		
	/**
	 * Runs a query to add users to the GUI
	 * 
	 * @return new String[] of users
	 * @version 1: no query, hard coded names
	 * @throws SQLException 
	 */
	private DefaultComboBoxModel populateUsers(DefaultComboBoxModel usersQuery) throws SQLException
	{
		usersQuery.removeAllElements();
		result = query.executeQuery(String.format("SELECT customer_id, first_name, last_name FROM %s.customer", username));
		usersQuery.addElement("-1: Select A User");
		while(result.next())
			usersQuery.addElement(String.format("%s: %s %s", result.getString("customer_id"), result.getString("first_name"), result.getString("last_name")));
		return usersQuery;
	}
	
	/**
	 * Builds the product view inventory,
	 * Contains the two buttons down below
	 * @throws SQLException 
	 */
	private void buildInventory()
	{
		inventory = new JPanel();
		inventory.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		inventory.setBounds(0,125,700,500);
		inventory.setLayout(new BorderLayout());
		
		inventoryButtons = new JPanel();
		inventoryButtons.setPreferredSize(new Dimension(700, 95));
		inventoryButtons.setLayout(null);
		inventoryButtons.setBackground(Color.LIGHT_GRAY);
		
		addToCart = new JButton("Add to Cart");
		addToCart.setBounds(475, 15, 125, 25);
		addToCart.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		addToCart.addActionListener(a -> {
			try { addToCart(products); } 
			catch (SQLException e1) {} });
		inventoryButtons.add(addToCart);
		
		previousPage = new JButton("<");
		previousPage.setEnabled(false);
		previousPage.setBounds(120, 40, 20, 20);
		previousPage.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		previousPage.addActionListener(p -> previousPage());
		inventoryButtons.add(previousPage);
		
		nextPage = new JButton(">");
		nextPage.setEnabled(false);
		nextPage.setBounds(250, 40, 20, 20);
		nextPage.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		nextPage.addActionListener(n -> nextPage());
		inventoryButtons.add(nextPage);
		
		currentPageNumber = 1;
		currentPage = new JLabel("" + currentPageNumber);
		currentPage.setBounds(190, 40, 20, 20);
		inventoryButtons.add(currentPage);
		
		addToWishList = new JButton("Add To Wish List");
		addToWishList.setBounds(475, 60, 125, 25);
		addToWishList.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		addToWishList.addActionListener(a -> {
			try { addToWishList(products); } 
			catch (SQLException e1) {} });
		inventoryButtons.add(addToWishList);
		
		queryString = "SELECT product.product_id, product.name FROM product";
		queryDetailsString = "SELECT name, description, cost FROM product WHERE product_id = %d";
		products = new JList(new DefaultListModel());
		products.setPreferredSize(new Dimension(400, 400));
		products.addListSelectionListener(p -> {
			try 
			{ 
				if(products.getSelectedIndex() > -1)
				{
					updateProductInfo((String)products.getSelectedValue()); 
					updateAdvertisement((String)products.getSelectedValue());
				}
			} 
			catch (SQLException e) {} });
		
		JPanel productInfo = new JPanel();
		productInfo.setPreferredSize(new Dimension(300, 400));
		productInfo.setLayout(null);
		
		productName = new JLabel();
		productName.setBounds(25, 25, 250, 25);
		productName.setHorizontalAlignment(JLabel.CENTER);
		productDescription = new JLabel("Description:");
		productDescription.setBounds(25, 75, 300, 100);
		productDescription.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		productCost = new JLabel("Cost");
		productCost.setBounds(25, 350, 150, 25);
		productCost.setHorizontalAlignment(JLabel.CENTER);
		
		productInfo.add(productName);
		productInfo.add(productDescription);
		productInfo.add(productCost);
		
		inventory.add(productInfo, BorderLayout.EAST);
		inventory.add(products, BorderLayout.WEST);
		inventory.add(inventoryButtons, BorderLayout.SOUTH);
		add(inventory);
	}
	
	/**
	 * Runs a query to initially populate the inventory
	 * Sets the MAX_PAGES for every query = Result Size / 23
	 * @throws SQLException 
	 * 
	 * @ return new DefaultListModel of products
	 * @ version 4: size calculated elsewhere
	 */
	private DefaultListModel populateProducts(DefaultListModel productsQuery, int maxPrice) throws SQLException
	{	
		productsQuery = new DefaultListModel();
		
		int offset = (currentPageNumber-1) * MAX_RESULTS_PER_PAGE;
		
		String priceLimit;
		if(queryString.contains("WHERE"))
			priceLimit = String.format(" AND Price < %d", maxPrice);
		else
			priceLimit = String.format(" WHERE Price < %d", maxPrice);
		String queryStringLimits = String.format(" LIMIT %d OFFSET %d", MAX_RESULTS_PER_PAGE, offset);
				
		result = query.executeQuery(queryString + priceLimit + queryStringLimits);
		while(result.next())
			productsQuery.addElement(String.format("%s:\t\t$%.2f:\t\t%s", result.getString("Name"), Double.parseDouble(result.getString("Price")), result.getString("Supplier")));
		
		MAX_PAGES = size / MAX_RESULTS_PER_PAGE;
		if(MAX_PAGES+1 < 2)
			nextPage.setEnabled(false);
		else
			nextPage.setEnabled(true);
		return productsQuery;
	}
	
	/**
	 * Calculates the total size of a search once
	 * 
	 * @return size: overall size of the result set
	 * @throws SQLException 
	 */
	private int getSearchSize() throws SQLException
	{
		String[] queries = queryString.split("\n");
		int size = 0;
		for(String q : queries)
		{
			result = query.executeQuery(q);
			while(result.next())
				size ++;
		}
		return size; 
	}
	
	/**
	 * Runs a query to gather product information from a selected product(s)
	 * 
	 * no return, hard data
	 * @version 2 : query on the product ID, handles only one at a time
	 * @throws SQLException
	 */
	private void updateProductInfo(String selected) throws SQLException
	{
		String[] product = selected.split(":");
		String prodName = product[0];
		Double prodPrice = Double.parseDouble(product[1].trim().substring(1, product[1].length()-2));
		
		result = query.executeQuery(String.format(queryDetailsString, prodName, prodPrice));
		if(result.first())
		{
			productName.setText(result.getString("Name"));
			productDescription.setText(convertToMulti(String.format("%s\nSupplied By: %s\nCategory: %s", result.getString("Description"), result.getString("Supplier"), result.getString("Category"))));
			productCost.setText("$" + Double.parseDouble(result.getString("Price")));
		}
	}
	
	/**
	 * Runs a query to gather suggested products for the customer, OR will use the not selling well view
	 * 
	 * @param p : String of the current selected product
	 * @throws SQLExeception
	 */
	private void updateAdvertisement(String p) throws SQLException
	{
		String[] pInfo = p.split(":");
		String pName = pInfo[0].trim();
		String pSupplier = pInfo[2].trim();
		
		result = query.executeQuery(String.format("SELECT Category FROM overall_inventory WHERE Name = '%s' AND Supplier = '%s'", pName, pSupplier));
		result.first();
		String catName = result.getString("Category");
		
		String text = "CHECK OUT THESE PRODUCTS!\n";
		result = query.executeQuery(String.format("SELECT category_id FROM categories WHERE name = '%s'", catName));
		if(result.first())
		{
			result.first();
			String catID = result.getString("category_id");
			result = query.executeQuery(String.format("CALL %s.most_highly_wished_product_by_category(%s)", username, catID));
			result.first();
			text += String.format("%s", result.getString("amount_per_category"));
			
		}
		else {
		result = query.executeQuery("SELECT * FROM not_selling_well");
		while(result.next())
			text += String.format("%s AT $ %.2f\n", result.getString("Name"), Double.parseDouble(result.getString("Price")));
		userAdvertisement.setText(convertToMulti(text));
		}
	}
	
	/**
	 * Builds the cart
	 */
	private void buildCart()
	{
		cart = new JPanel();
		cart.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		cart.setBounds(700, 125, 300, 500);
		cart.setLayout(new BorderLayout());
		
		cartButtons = new JPanel();
		cartButtons.setBackground(Color.CYAN);
		cartButtons.setPreferredSize(new Dimension(250, 100));
		cartButtons.setLayout(null);
		
		saveCart = new JButton("Remove Item");
		saveCart.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		saveCart.setBounds(0, 15, 150, 30);
		saveCart.addActionListener(a -> { removeFromList(shoppingCart); updateTotalCost(shoppingCart); } ); 
		
		placeOrder = new JButton("Order");
		placeOrder.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		placeOrder.setBounds(0, 50, 200, 40);
		placeOrder.addActionListener(e -> checkOrder(shoppingCart.getModel().getSize()));
		
		totalCost = new JLabel("$0.00");
		totalCost.setBounds(175, 15, 240, 30);
		
		cartButtons.add(saveCart);
		cartButtons.add(placeOrder);
		cartButtons.add(totalCost);
		
		shoppingCart = new JList(new DefaultListModel());
		shoppingCart.setPreferredSize(new Dimension(250, 550));
		
		cart.add(cartButtons, BorderLayout.SOUTH);
		cart.add(shoppingCart, BorderLayout.CENTER);
		
		add(cart);
	}
	
	/**
	 * brings up the order menu if the cart has more than 0 products
	 */
	private void checkOrder(int numProducts)
	{
		String curr = ((String)users.getSelectedItem()).split(":")[0];
		if(numProducts > 0)
			new Order(shoppingCart, curr, username, password); 
	}
	
	/**
	 * Builds the wishlist
	 * contains
	 * 	> WishList
	 * 	> Ratings
	 */
	private void buildWishList()
	{
		wishList = new JPanel();
		wishList.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		wishList.setBounds(0, 650, 700, 150);
		wishList.setLayout(new BorderLayout());
		
		userWishList = new JList(new DefaultListModel());
		userWishList.setPreferredSize(new Dimension(300,100));
		
		JPanel userWishListOptions = new JPanel();
		userWishListOptions.setPreferredSize(new Dimension(100, 100));
		userWishListOptions.setLayout(null);
		
		wishListOrder = new JButton("Move to Cart");
		wishListOrder.setBounds(5, 25, 90, 20);
		wishListOrder.addActionListener(a -> {
			try { addToCart(userWishList); } 
			catch (SQLException e) {} });
		wishListRemove = new JButton("Remove");
		wishListRemove.setBounds(5, 75, 90, 20);
		wishListRemove.addActionListener(b -> {
			try { removeFromWishList(userWishList); } 
			catch (SQLException e) {} });
		
		userWishListOptions.add(wishListOrder);
		userWishListOptions.add(wishListRemove);
		
		userAdvertisement = new JLabel();
		userAdvertisement.setPreferredSize(new Dimension(300, 100));
		
		wishList.add(userWishListOptions,BorderLayout.CENTER);
		wishList.add(userAdvertisement, BorderLayout.EAST);
		wishList.add(userWishList, BorderLayout.WEST);
		add(wishList);
	}
	
	/**
	 * Builds the admin panel
	 * Panel contains:
	 * 	> admin button
	 * 	> advertisement
	 */
	private void buildAdmin()
	{
		admin = new JPanel();
		admin.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		admin.setBounds(700, 650, 300, 150);
		admin.setLayout(null);
		
		adminTools = new JButton("Admin Access");
		adminTools.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		adminTools.setBounds(50, 125, 200, 25);
		adminTools.addActionListener(a -> new Admin(username, password));
		
		admin.add(adminTools, BorderLayout.SOUTH);
		add(admin);
	}
	
	/**
	 * Builds the options bar
	 * Bar contains:
	 * 	> databases
	 * 	> search btn
	 */
	private void buildOptions()
	{
		options = new JPanel();
		options.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		options.setBounds(0, 0, 700, 100);
		options.setLayout(null);
		
		filterSearch = new JComboBox(new String[] {"None", "Marketplace", "Categories", "Suppliers"});
		filterSearch.setBounds(0, 40, 150,25);
		filterSearch.addActionListener(a -> setSubSearchFilter((String)filterSearch.getSelectedItem()));
		
		filterSubSearch = new JComboBox(new String[] {"None"});
		filterSubSearch.setBounds(175, 40, 150, 25);
		
		maxPrice = new JLabel("$");
		maxPrice.setBounds(525,65, 150, 20);
		maxPrice.setHorizontalAlignment(JLabel.CENTER);
		priceRange = new JSlider(0, 100, 50);
		priceRange.setBounds(525, 40, 150, 25);
		priceRange.setMajorTickSpacing(20);
		priceRange.setMinorTickSpacing(5);
		priceRange.setPaintTicks(true);
		priceRange.setValue(100);
		priceRange.addChangeListener(ce -> {
			try { updatePriceFilter(); } 
			catch (SQLException e) {} });
		
		search = new JButton("Search");
		search.setBounds(300,75, 100, 25);
		search.setBorder(BorderFactory.createLineBorder(Color.BLACK));
		search.setEnabled(true);
		search.addActionListener(s -> search((String)filterSearch.getSelectedItem(), (String)filterSubSearch.getSelectedItem(), priceRange.getValue()));
		
		JLabel f = new JLabel("Filter By");
		f.setBounds(0,10, 150,25);
		f.setHorizontalAlignment(JLabel.CENTER);
		
		subSearchLabel = new JLabel("None");
		subSearchLabel.setBounds(175, 10, 150, 25);
		subSearchLabel.setHorizontalAlignment(JLabel.CENTER);
		
		JLabel p = new JLabel("Price Range");
		p.setBounds(525, 10, 150, 25);
		p.setHorizontalAlignment(JLabel.CENTER);
		
		options.add(f);
		options.add(subSearchLabel);
		options.add(p);
		
		options.add(filterSearch);
		options.add(filterSubSearch);
		options.add(priceRange);
		options.add(maxPrice);
		
		options.add(search);
		add(options);
	}
	
	/**
	 * Runs a query to generate all the suppliers
	 * 
	 * @return a DefaultComboBoxModel of all found suppliers
	 * @version 4 : query from both views
	 */
	private DefaultComboBoxModel populateSuppliers(DefaultComboBoxModel suppliers) throws SQLException
	{
		result = query.executeQuery("SELECT Supplier FROM our_product GROUP BY Supplier");
		while(result.next())
			suppliers.addElement(result.getString("Supplier"));
		
		result = query.executeQuery("SELECT Supplier FROM partners_inventory GROUP BY Supplier");
		while(result.next())
			suppliers.addElement(result.getString("Supplier"));
		return suppliers;
	}
	
	/**
	 * Runs a query to generate all the categories
	 * 
	 * @return a new ComboListModel of all found categories
	 * @version 4 : query from both views
	 */
	private  DefaultComboBoxModel populateCategories(DefaultComboBoxModel categories) throws SQLException
	{
		result = query.executeQuery("SELECT Category FROM our_product GROUP BY Category");
		while(result.next())
			categories.addElement(result.getString("Category"));
		
		result = query.executeQuery("SELECT Category FROM partners_inventory GROUP BY Category");
		while(result.next())
			categories.addElement(result.getString("Category"));
		return categories;
	}
	
	/**
	 * Runs a query to find the most expensive item in the Inventory
	 * 
	 * @param orderBy: Detailing which DB to order by
	 * no return, sets new highest found cost
	 * @version 3 : query, using search query
	 */
	private void populatePrice(String orderBy) throws SQLException
	{
		result = query.executeQuery(queryString + orderBy);
		double newCost = 100.00;
		while(result.next())
		{
			try { newCost = Double.parseDouble(result.getString("Price")); break; }
			catch (NumberFormatException e) {};
		}
	
		try{ priceRange.setMaximum(((int)newCost + 1)); } 
		catch (NumberFormatException e) {};
		priceRange.setValue(priceRange.getMaximum());
		priceRange.setMajorTickSpacing(priceRange.getMaximum() / 5);
		priceRange.setMinorTickSpacing(priceRange.getMaximum() / 10);
	}
	
	/**
	 * Updates the price label as well as filters different products by price
	 * @throws SQLException
	 */
	private void updatePriceFilter() throws SQLException
	{
		maxPrice.setText("$" + priceRange.getValue());
		
		/*String tempQuery = queryString;
		if(((String)filterSearch.getSelectedItem()).equals("Marketplace") || ((String)filterSearch.getSelectedItem()).equals("None"))
			queryString += String.format(" WHERE Price < %d", priceRange.getValue());
		else
			queryString += String.format(" AND Price < %d", priceRange.getValue());*/
			
		products.setModel(populateProducts((DefaultListModel)products.getModel(), priceRange.getValue()));
	}
	
	/**
	 * Creates a String for the populateProducts method to execute a proper query
	 * 
	 * returns a string to be used in the populateProducts function
	 * @version 2 : no query
	 * @throws SQLException 
	 */
	private void search(String searchQ, String subSearchQ, int price)
	{
		switch(searchQ)
		{
			case "Marketplace":
			{
				switch(subSearchQ)
				{
					case "northwind":
					{
						queryString = "SELECT * FROM northwind_product";
						queryDetailsString = "SELECT * FROM northwind_product WHERE Name = '%s' AND Price = %.2f";
						currentDB = "northwind";
						break;
					}
					
					case "adventureworks":
					{
						queryString = "SELECT * FROM adventureworks_product";
						queryDetailsString = "SELECT * FROM adventureworks_product WHERE Name = '%s' AND Price = %.2f";
						currentDB = "adventureworks";
						break;
					}
					
					case "sakila":
					{
						queryString = "SELECT * FROM sakila_product";
						queryDetailsString = "SELECT * FROM sakila_product WHERE Name = '%s' AND Price = %.2f";
						currentDB = "sakila";
						break;
					}
					default:
					{
						queryString = "SELECT * FROM our_product";
						queryDetailsString = "SELECT * FROM our_product WHERE Name = '%s' AND Price = %.2f";
						currentDB = "our";
						break;
					}
				}
				break;
			}
			case "Categories":
			{
				queryString = String.format("SELECT * FROM overall_inventory WHERE Category = '%s'", subSearchQ);
				queryDetailsString = "SELECT * FROM overall_inventory WHERE Name = '%s' AND Price = %.2f";
				break;
			}
			case "Suppliers":
			{
				queryString = String.format("SELECT * FROM overall_inventory WHERE Supplier = '%s'", subSearchQ);
				queryDetailsString = "SELECT * FROM overall_inventory WHERE Name = '%s' AND Price = %.2f";
				break;
			}
			default:
			{
				queryString = "SELECT * FROM overall_inventory";
				queryDetailsString = "SELECT * FROM overall_inventory WHERE Name = '%s' AND Price = %.2f";
			}
		}
		currentPageNumber = 1;
		currentPage.setText(""+currentPageNumber);
		products.setSelectedIndex(-1);;
		
		try { size = getSearchSize(); }
		catch (SQLException E) {};
		try { populatePrice(" ORDER BY Price DESC"); }	
		catch (SQLException E) {};	
		try { products.setModel(populateProducts((DefaultListModel)products.getModel(), priceRange.getValue())); }
		catch (SQLException E) {};	
	}
	
	/**
	 * Runs a query to populate the sub search filter drop down, change label text
	 * @param searchType
	 * @version 1 : hard data, no query, case statement
	 */
	private void setSubSearchFilter(String searchType)
	{
		subSearchLabel.setText(searchType);
		((DefaultComboBoxModel)filterSubSearch.getModel()).removeAllElements();
		
		switch(searchType)
		{
			case "Marketplace":
			{
				filterSubSearch.setModel(new DefaultComboBoxModel(new String[] {"Daymnzon", "adventureworks", "sakila", "northwind"}));
				break;
			}
			case "Categories":
			{
				try { filterSubSearch.setModel(populateCategories((DefaultComboBoxModel)filterSubSearch.getModel())); }
				catch (SQLException e) {};
				break;
			}
			case "Suppliers":
			{
				try { filterSubSearch.setModel(populateSuppliers((DefaultComboBoxModel)filterSubSearch.getModel())); }
				catch (SQLException e) {};
				break;
			}
			default:
				filterSubSearch.setModel(new DefaultComboBoxModel(new String[] {"NONE"}));
				break;
		}
	}
	
	/**
	 * runs a query add the selected values into the Shopping Cart
	 * > Get current user id
	 * > run insert into table queries for each selected product
	 * 
	 * @param list : list in which to insert
	 * @version 4 : populates shopping cart with the string, calls updateTotalCost()
	 */
	private void addToCart(JList list) throws SQLException
	{
		String currUserID = ((String)users.getSelectedItem()).split(":")[0];
		
		int[] selectedProducts = list.getSelectedIndices();
		String currProductName;
		for(int i : selectedProducts)
		{
			currProductName = ((String)list.getModel().getElementAt(i)).split(":")[0];
			result = query.executeQuery(String.format("SELECT * FROM overall_inventory WHERE Name = '%s'", currProductName));
			result.first();
			
			String name = result.getString("Name");
			String id = result.getString("ID");
			String price = result.getString("Price");
			Double priceNum; 
			try { priceNum = Double.parseDouble(price); }
			catch(NumberFormatException e) { priceNum = Double.parseDouble(((String)list.getModel().getElementAt(i)).split(":")[1].trim().substring(1)); }
			
			((DefaultListModel)shoppingCart.getModel()).addElement(String.format("%s:\t$%.2f", name, priceNum));
		}
		updateTotalCost(shoppingCart);
	}
	
	/**
	 * Updates the total cost of the cart
	 * 
	 * takes info from the list, gathers info
	 * @param list : list to gather products from
	 */
	private void updateTotalCost(JList list)
	{
		double sum = 0.0;
		String currProductValue;
		for(int i = 0; i < list.getModel().getSize(); i ++)
		{
			currProductValue = ((String)list.getModel().getElementAt(i)).split(":")[1].trim().substring(1);
			sum += Double.parseDouble(currProductValue);
		}
		totalCost.setText(String.format("$%.2f", sum));
	}
	
	/**
	 * Adds the select products to the wishList
	 * 
	 * no return, just moves over data
	 */
	private void addToWishList(JList from) throws SQLException
	{
		String currUserID = ((String)users.getSelectedItem()).split(":")[0];
		
		int[] selectedProducts = from.getSelectedIndices();
		String currProductName;
		for(int i : selectedProducts)
		{
			currProductName = ((String)from.getModel().getElementAt(i)).split(":")[0];
			result = query.executeQuery(String.format("SELECT * FROM our_product WHERE Name = '%s'", currProductName));
			result.first();
			
			String name = result.getString("Name");
			String id = result.getString("ID");
			
			query.execute(String.format("CALL %s.add_to_wish_list(%s, %s);", username, currUserID, id));
			populateUserWishList(Integer.parseInt(currUserID), ((DefaultListModel)userWishList.getModel()));
		}
	}
	
	/**
	 * Removes the selected item for the wishlist in the database
	 */
	private void removeFromWishList(JList from) throws SQLException
	{
		String currUserID = ((String)users.getSelectedItem()).split(":")[0];
		
		int[] selectedProducts = from.getSelectedIndices();
		String currProductName;
		for(int i : selectedProducts)
		{
			currProductName = ((String)from.getModel().getElementAt(i)).split(":")[0];
			result = query.executeQuery(String.format("SELECT * FROM our_product WHERE Name = '%s'", currProductName));
			result.first();
			
			String id = result.getString("ID");
			query.execute(String.format("DELETE FROM customer_wish WHERE customer_id = %s AND product_id = %s", currUserID, id));
			populateUserWishList(Integer.parseInt(id), ((DefaultListModel)userWishList.getModel()));
		}
	}
	
	/**
	 * Removes the selected item from the cart
	 * 
	 * no return
	 */
	private void removeFromList(JList from)
	{
		int[] i = from.getSelectedIndices();
		String product;
		for(int index : i)
		{
			((DefaultListModel)from.getModel()).remove(index);
		}
	}

	/**
	 * previous page functions as research products, with a different offset
	 * also
	 * 	> changes currentPage field --;
	 * 	> deactivates on 1
	 * 
	 * @version 1: just decrement currentPageNumber
	 */
	private void previousPage()
	{
		currentPageNumber--;
		nextPage.setEnabled(true);
		currentPage.setText("" + currentPageNumber);
		
		products.setSelectedIndex(-1);
		try { products.setModel(populateProducts((DefaultListModel)products.getModel(), priceRange.getValue())); }
		catch (SQLException E) {};
		
		if(currentPageNumber == 1)
		{
			previousPage.setEnabled(false);
			return;
		}
	}
	
	/**
	 * next page function is the inverse of previousPage
	 * also
	 * 	> changes currentPageNumber ++;
	 *  
	 * @version 2: just increment currentPageNumber, decativate on 10
	 */
	private void nextPage()
	{
		currentPageNumber++;
		previousPage.setEnabled(true);
		currentPage.setText("" + currentPageNumber);
		
		products.setSelectedIndex(-1);;
		try { products.setModel(populateProducts((DefaultListModel)products.getModel(), priceRange.getValue())); }
		catch (SQLException E) {};
		
		if(currentPageNumber == MAX_PAGES + 1)
		{
			nextPage.setEnabled(false);
			return;
		}
	}

	/**
	 * next page helper method, user for the keystrokes
	 * 
	 * @param currentIndex, if current index is at bottom of page, decrement
	 * @param keyStroke, if up, or right -> next page
	 * 					down or left -> previousPage
	 */
	private void changePageHelpter(int currentIndex, KeyEvent keyStroke)
	{
		
	}
	
	/**
	 * Sets the overall GUI to enabled or disabled
	 */
	private void setGUIEnabled(boolean enabled)
	{ setEnabled(enabled); }
	
	/**
	 * Helper method for turning all the labels into multi line
	 */
	private String convertToMulti(String s)
	{ return "<html>" + s.replaceAll("\n", "<br>"); }
}

import javax.swing.JList;

/**
 * TODO
 * Add a product
 */
/**
 * Admin Page for the GUI
 * Shows products 
 * @author martinprice
 *
 */
import java.awt.*;
import java.sql.*;
import javax.swing.*;

public class Admin extends JFrame
{
	private Connection conn;
	private Statement query;
	private ResultSet result;
	
	private JPanel restock;
	private JPanel customers;
	private JPanel customerUpdates;
	private JPanel customerOrders;
	
	private JLabel productID;
	private JLabel productName;
	private JLabel productSupplier;
	
	private JLabel customerID;
	private JTextField customerUserName;
	private JTextField customerName;
	private JTextField customerEmail;
	
	private JLabel orderProductName;
	private JLabel orderDatePurchased;
	private JLabel orderStatus;
	
	private JButton addCustomer;
	private JButton removeCustomer;
	private JButton updateCustomer;
	
	private JList restockList;
	private JList customersList;
	private JList customerOrderList;
	
	private String username;
	private String password;
	
	/**
	 * Constructor
	 * 
	 * @param un, pw : Credentials used for the DB
	 */ 	
	public Admin(String un, String pw)
	{
		super("Admin Access");
		if(setUpConnection(un, pw))
		{
			System.out.println("CONNECTION ESTABLSIHED");
			createGUI();
		}	
		else
			System.err.println("COULD NOT CONNECT TO THE DATABASE");
	}
	
	/**
	 * Initializes SQL variables and connects to the data base
	 *
	 * @param un : user name
	 * @param pw : password
	 * @return true, no issues
	 * @throws SQLException 
	 */
	private boolean setUpConnection(String un, String pw)
	{
		username = un;
		password = pw;
		
		try 
		{
			conn = DriverManager.getConnection(String.format("jdbc:mysql://elvis.rowan.edu:3306/%s?&useSSL=false&useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC", un), un, pw);
			query = conn.createStatement();
			return true;
		}
		catch(SQLException e) {e.printStackTrace(); return false;}
		
	}

	/**
	 * Creates the GUI
	 */
	private void createGUI()
	{
		setSize(750,500);
		setLayout(new BorderLayout());
		
		buildRestock();
		buildCustomer();
		buildCustomerOrders();
		buildCustomerUpdates();
		
		setVisible(true);
	}
	
	/**
	 * builds the restock list,
	 * 	displays all products that have been restocked
	 * 	Place on the West side of the frame
	 */
	private void buildRestock()
	{
		restock = new JPanel();
		restock.setPreferredSize(new Dimension(250, 425));
		restock.setLayout(null);
		
		productID = new JLabel("ID");
		productID.setBounds(25, 310, 50, 20);
		productName = new JLabel("Name");
		productName.setBounds(25, 340, 200, 20);
		productSupplier = new JLabel("Supplier");
		productSupplier.setBounds(25, 370, 200, 20);
		
		try { restockList = new JList(populateRestockList(new DefaultListModel())); }
		catch (SQLException e) {};
		restockList.setBounds(0, 0, 245, 300);
		restockList.addListSelectionListener(a -> {
			try { populateResupplyInfo(restockList.getSelectedIndex()); } 
			catch (SQLException e) {} });
		
		restock.add(productID);
		restock.add(productName);
		restock.add(productSupplier);
		restock.add(restockList);
		add(restock, BorderLayout.WEST);
	}
	
	/**
	 * runs a query to populate the restock list
	 * 
	 * @param list : list to be populated
	 * @return list : populated from the query
	 * @throws SQLException
	 */
	private DefaultListModel populateRestockList(DefaultListModel list) throws SQLException
	{
		list = new DefaultListModel();
		
		result = query.executeQuery("SELECT * FROM restock");
		while(result.next())
			list.addElement(String.format("Restock:\t%s\tOn:\t%s", result.getString("restock_id"), result.getString("date")));
		return list;
	}
	
	/**
	 * runs a query to populate the product info labels
	 * 
	 * @param index : index of the selected value\
	 * throws SQLException
	 */
	private void populateResupplyInfo(int index) throws SQLException
	{
		String[] r = ((String)restockList.getModel().getElementAt(index)).split(":");
		String r_id = r[1].split("\t")[1];
		
		result = query.executeQuery(String.format("SELECT product_id AS ID FROM restock WHERE restock_id = %s", r_id));
		result.first();
		String p_id = result.getString("ID");
		
		result = query.executeQuery(String.format("SELECT * FROM our_product WHERE ID = %s", p_id));
		result.first();
		productID.setText(p_id);
		productName.setText(result.getString("Name"));
		productSupplier.setText(result.getString("Supplier"));
	}

	/**
	 * Creates the customer Panel
	 * 	Displays all customers as well as customers their data
	 * Place on the Center of the frame
	 */
	private void buildCustomer()
	{
		customers = new JPanel();
		customers.setPreferredSize(new Dimension(250, 425));
		customers.setLayout(null);
		
		addCustomer = new JButton("ADD");
		addCustomer.setBounds(80, 310, 75, 20);
		addCustomer.addActionListener(a -> {
			try { addCustomer(); } 
			catch (SQLException e1) {} });
		
		removeCustomer = new JButton("REMOVE");
		removeCustomer.setBounds(80, 340, 75, 20);
		removeCustomer.addActionListener(a -> {
			try { removeCustomer(); } 
			catch (SQLException e1) {} });
		
		updateCustomer = new JButton("UPDATE");
		updateCustomer.setBounds(80, 370, 75, 20);
		updateCustomer.addActionListener(a -> {
			try { updateCustomer(); }
			catch (SQLException e1) {} });
		
		try { customersList = new JList(populateCustomersList(new DefaultListModel())); }
		catch (SQLException e) {};
		customersList.setBounds(0,0,250,300);
		customersList.addListSelectionListener(a -> {
			try 
			{ 	
				populateCustomerInfo(customersList.getSelectedIndex()); 
				customerOrderList.setModel(populateCustomerOrderList(new DefaultListModel(), customersList.getSelectedIndex())); 
			} 
			catch (SQLException e) {} });
		
		customers.add(addCustomer);
		customers.add(updateCustomer);
		customers.add(removeCustomer);
		customers.add(customersList);
		add(customers, BorderLayout.CENTER);
	}

	/**
	 * Adds a new customer to the database
	 */
	private void addCustomer() throws SQLException
	{
		String[] name = customerName.getText().split(" ");
		query.execute(String.format("INSERT INTO customer(username, first_name, last_name, email) VALUES ('%s', '%s', '%s', '%s')", customerUserName.getText(),
				name[0], name[1], customerEmail.getText()));
		customersList.setModel(populateCustomersList(((DefaultListModel)customersList.getModel())));
	}
	
	/**
	 * removes a customer from the database
	 */
	private void removeCustomer() throws SQLException
	{
		String id = customerID.getText();
		query.execute(String.format("DELETE FROM customer WHERE customer_id = %s",id));
		customersList.setSelectedIndex(-1);
		customersList.setModel(populateCustomersList(((DefaultListModel)customersList.getModel())));
	}
	
	/**
	 * updates a customer from the dataBase
	 */
	private void updateCustomer() throws SQLException
	{
		String[] name = customerName.getText().split(" ");
		query.execute(String.format("UPDATE customer SET username = '%s', first_name = '%s', last_name = '%s', email = '%s' WHERE customer_id = '%s'",
				customerUserName.getText(), name[0], name[1], customerEmail.getText(), customerID.getText()));
		customersList.setSelectedIndex(-1);
		customersList.setModel(populateCustomersList(((DefaultListModel)customersList.getModel())));
	}
	
	/**
	 * runs a query to populate the customers list
	 * 
	 * @param list : list to be populated
	 * @return list : populate form the query
	 * @throws SQLException
	 */
	private DefaultListModel populateCustomersList(DefaultListModel list) throws SQLException
	{
		list = new DefaultListModel();
		
		result = query.executeQuery("SELECT * FROM customer");
		while(result.next())
			list.addElement(String.format("User ID:\t%s\tUsername:\t%s", result.getString("customer_id"), result.getString("username")));
		return list;
	}

	/**
	 * runs a query to populate the customer information
	 * 
	 * @param index: selected index of the customer
	 * @throws SQLException
	 */
	private void populateCustomerInfo(int index) throws SQLException
	{
		String[] c = ((String)customersList.getModel().getElementAt(index)).split(":");
		String c_id = c[1].split("\t")[1];
		
		result = query.executeQuery(String.format("SELECT * FROM customer WHERE customer_id = %s", c_id));
		result.first();
		customerID.setText(result.getString("customer_id"));
		customerName.setText(String.format("%s %s", result.getString("first_name"), result.getString("last_name")));
		customerEmail.setText(result.getString("email"));
		customerUserName.setText(result.getString("username"));
	}
	
	/**
	 * builds the customer orders
	 * 	Found on the East part of the gui
	 */
	private void buildCustomerOrders()
	{
		customerOrders = new JPanel();
		customerOrders.setPreferredSize(new Dimension(250, 425));
		customerOrders.setLayout(null);
		
		customerOrderList = new JList(new DefaultListModel());
		customerOrderList.setBounds(5, 0, 245, 300);
		customerOrderList.addListSelectionListener(a -> {
			try { populateOrderInfo(customerOrderList.getSelectedIndex()); } 
			catch (SQLException e) {} });
		
		orderProductName = new JLabel("Name");
		orderProductName.setBounds(25, 310, 50, 20);
		orderDatePurchased = new JLabel("Date");
		orderDatePurchased.setBounds(25, 340, 200, 20);
		orderStatus = new JLabel("Status");
		orderStatus.setBounds(25, 370, 200, 20);
		
		customerOrders.add(customerOrderList);
		customerOrders.add(orderProductName);
		customerOrders.add(orderDatePurchased);
		customerOrders.add(orderStatus);
		add(customerOrders, BorderLayout.EAST);
	}
	
	/**
	 * runs a query to populate recent transactions made by the customer
	 * 
	 * @param list : list to be populated
	 * @param index : selected customer
	 * @return list : populated with user purchased
	 * @throws SQLException
	 */
	private DefaultListModel populateCustomerOrderList(DefaultListModel list, int index) throws SQLException
	{
		list = new DefaultListModel();
		String[] c = ((String)customersList.getModel().getElementAt(index)).split(":");
		String id = c[1].split("\t")[1];
		result = query.executeQuery(String.format("SELECT * FROM %s.order WHERE customer_id = %s ORDER BY date DESC LIMIT 17", username, id));
		while(result.next())
			list.addElement(String.format("Order ID:\t%s\t\tProduct ID:\t%s", result.getString("order_id"), result.getString("product_id")));
		return list;
	}
	
	/**
	 * runs a query to populate the labels for each order
	 * 
	 * @param index : selected index of an order
	 * @throws SQLException
	 */
	private void populateOrderInfo(int index) throws SQLException
	{
		String[] o = ((String)customerOrderList.getModel().getElementAt(index)).split(":");
		String p_id = o[2].trim();
		String o_id = o[1].split("\t")[1];
		
		result = query.executeQuery(String.format("SELECT * FROM %s.order WHERE order_id = %s", username, o_id));
		result.first();
		String p_name = result.getString("product_name");
		orderProductName.setText(p_name);
		orderDatePurchased.setText(result.getString("date"));
		orderStatus.setText(result.getString("status"));
	}

	/**
	 * builds the options bar for modifying the customers
	 * Goes on the south of the frame
	 */
	private void buildCustomerUpdates()
	{
		customerUpdates = new JPanel();
		customerUpdates.setLayout(null);
		customerUpdates.setPreferredSize(new Dimension(750, 75));
		
		customerID = new JLabel("ID");
		customerID.setBounds(150, 40, 25, 20);
		customerName = new JTextField("Name");
		customerName.setBounds(180, 40, 120, 20);
		customerEmail = new JTextField("Email");
		customerEmail.setBounds(305, 40, 200, 20);
		customerUserName = new JTextField("Username");
		customerUserName.setBounds(510, 40, 150, 20);

		customerUpdates.add(customerID);
		customerUpdates.add(customerName);
		customerUpdates.add(customerEmail);
		customerUpdates.add(customerUserName);
		add(customerUpdates, BorderLayout.SOUTH);
	}
}


/**
 * Helper class for the GUI brings up a window to place an order
 * 
 * Allows user to select their shipping address
 * @author martinprice
 *
 */
import java.awt.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.*;

/**
 * TODO Estimated Shipping
 * 	Arrival data
 * 	Total Cost
 * 	Move Things over
 */

/**
 * 
 * @author martinprice
 *
 */
public class Order extends JFrame
{
	private JPanel addresses;
	private JPanel order;
	private JPanel buttons;
	
	private JList shoppingCart;
	private JComboBox customerAddresses;
	
	private JLabel addressLabel;
	
	private JButton placeOrder;
	private JButton cancelOrder;
	
	
	private String username;
	private String currentUserId;
	private Connection conn;
	private Statement query;
	private ResultSet result;
	
	/**
	 * Constructor
	 * 
	 * @param cart : DefaultListModel of current items in shopping cart
	 * @param c_id : customer id
	 */
	public Order(JList cart, String c_id, String un, String pw)
	{
		super("Place Order");
		currentUserId = c_id;
		username = un;
		if(setUpConnection(un, pw))
		{
			System.out.println("CONNECTION ESTABLSIHED");
			createGUI(cart, c_id);
		}	
		else
			System.err.println("COULD NOT CONNECT TO THE DATABASE");
	}
	
	/**
	 * Initializes SQL variables and connects to the data base
	 *
	 * @param un : user name
	 * @param pw : password
	 * @return true, no issues
	 * @throws SQLException 
	 */
	private boolean setUpConnection(String un, String pw)
	{
		try 
		{
			conn = DriverManager.getConnection(String.format("jdbc:mysql://elvis.rowan.edu:3306/%s?&useSSL=false&useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC", un), un, pw);
			query = conn.createStatement();
			return true;
		}
		catch(SQLException e) {e.printStackTrace(); return false;}
	}
	
	/**
	 * Builds the GUI
	 */
	private void createGUI(JList cart, String c_id)
	{
		setSize(500, 500);
		setLayout(new BorderLayout());
		
		buildCart(cart);
		buildAddresses(c_id);
		buildButtons();
		
		setVisible(true);
	}
	
	/**
	 * builds the cart
	 * Goes on the West part of Frame
	 * displays the items to be purchases and overall cost
	 * 
	 * @param cart : shoppingCart from Main Gui
	 */
	private void buildCart(JList cart)
	{
		order = new JPanel();
		order.setPreferredSize(new Dimension(250, 400));
		order.setLayout(new BorderLayout());
		
		shoppingCart = new JList(cart.getModel());
		shoppingCart.setPreferredSize(new Dimension(250, 350));
		
		order.add(shoppingCart, BorderLayout.NORTH);
		add(order, BorderLayout.WEST);
	}
	
	/**
	 * bulds the addresses
	 * Goes on the East part of the Frame
	 * Consists of a drop down box for a customers addresses
	 * Displays a shipping location and eastimated shipping time
	 * 
	 * @param c_id : customer_id
	 */
	private void buildAddresses(String c_id)
	{
		addresses = new JPanel();
		addresses.setPreferredSize(new Dimension(250, 400));
		addresses.setLayout(new BorderLayout());
		
		try { customerAddresses = new JComboBox(populateAddresses(new DefaultComboBoxModel(), c_id)); }
		catch (SQLException e) {};
		customerAddresses.setPreferredSize(new Dimension(250, 50));
		customerAddresses.addActionListener(e -> updateAddressText(((String)customerAddresses.getSelectedItem())) );
		
		addressLabel = new JLabel();
		addressLabel.setPreferredSize(new Dimension(250, 300));
		
		addresses.add(addressLabel, BorderLayout.SOUTH);
		addresses.add(customerAddresses, BorderLayout.NORTH);
		
		add(addresses, BorderLayout.EAST);
	}
	
	/**
	 * populates the address combo box using a query
	 * 
	 * @param ad :
	 * @param c_id : customer id
	 * @return ad : populated with addresses 
	 */
	private DefaultComboBoxModel populateAddresses(DefaultComboBoxModel ad, String c_id) throws SQLException
	{
		result = query.executeQuery(String.format("SELECT * FROM customer_area WHERE customer_id = %s", c_id));
		while(result.next())
			ad.addElement(String.format("%s\t%s\t%s\t%s", result.getString("street"), result.getString("city"), result.getString("state"), result.getString("zipcode")));
		return ad;
	}
	
	/**
	 * populates the address JLabel with current information 
	 */
	private void updateAddressText(String address)
	{
		String[] a = address.split("\t");
		String text = String.format("Ship the order to:\nStreet: %s\nCity: %s\nState: %s\nZip Code: %s", a[0], a[1], a[2], a[3]);
		addressLabel.setText(convertToMulti(text));
	}
	
	/**
	 * builds the buttons panel
	 */
	private void buildButtons()
	{
		buttons = new JPanel();
		buttons.setPreferredSize(new Dimension(500, 100));
		buttons.setLayout(null);
		
		placeOrder = new JButton("Order Cart");
		placeOrder.setBounds(250,40,75,20);
		placeOrder.addActionListener(e -> {
			try { placeOrder(); } 
			catch (SQLException e1) {} });
		
		cancelOrder = new JButton("Cancel Order");
		cancelOrder.setBounds(375, 40, 100, 20);
		cancelOrder.addActionListener(e -> cancelOrder());
		
		buttons.add(placeOrder);
		buttons.add(cancelOrder);
		
		add(buttons, BorderLayout.SOUTH);
	}

	/**
	 * Places an order into the query
	 */
	private void placeOrder() throws SQLException
	{
		for(int i = 0; i < shoppingCart.getModel().getSize(); i++)
		{
			String currProductName = ((String)shoppingCart.getModel().getElementAt(i)).split(":")[0];
			result = query.executeQuery(String.format("SELECT * FROM overall_inventory WHERE Name = '%s'", currProductName));
			result.first();
			
			String name = result.getString("Name");
			String id = result.getString("ID");
			String price = result.getString("Price");
			Double priceNum; 
			try { priceNum = Double.parseDouble(price); }
			catch(NumberFormatException e) { priceNum = Double.parseDouble(((String)shoppingCart.getModel().getElementAt(i)).split(":")[1].trim().substring(1)); }
			
			System.out.println(String.format("CALL %s.place_order(1, %s, %s, '%s')", username, currentUserId, id, name));
			query.execute(String.format("CALL %s.place_order(1, %s, %s, '%s')", username, currentUserId, id, name));
			System.out.println("HERE");
		}
	}
	
	private void cancelOrder()
	{
		System.exit(0);
	}
	
	/**
	 * Helper method for turning all the labels into multi line
	 */
	private String convertToMulti(String s)
	{ return "<html>" + s.replaceAll("\n", "<br>"); }
}

public class Main 
{
	public static void main(String[] args)
	{
		GUI g = new GUI("pricem2", "crabjournal");
	}
}
